<?xml version="1.0" encoding="utf-8" standalone="no"?>
<Tgs_fr4SingleReport Version="4.8.2" DotMatrixReport="True" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="По умолчанию" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="40584.6157234838" ReportOptions.Description.Text="" ReportOptions.LastChange="40708.7295478704" ScriptLanguage="PascalScript" ScriptText.Text="procedure OnBeforeReportPrint(Sender: TfrxComponent);&#13;&#10;var&#13;&#10;  Q, P, Np, Comp, Header: TgsDataSet;&#13;&#10;  DateBegin, DateEnd: TDate;&#13;&#10;  BaseQuery: QueryList;&#13;&#10;  DocDate: TDate;&#13;&#10;  NomPP, DocKey, I: Integer;                                         &#13;&#10;begin&#13;&#10;  DateBegin := StrToDate(&#60;DateBegin&#62;);                           &#13;&#10;  DateEnd := StrToDate(&#60;DateEnd&#62;);&#13;&#10;&#13;&#10;  BaseQuery := GetQueryList;&#13;&#10;  BaseQuery.Clear;&#13;&#10;        &#13;&#10;  Q := BaseQuery.Query[BaseQuery.Add('Q', False)];&#13;&#10;  Q.SQL :=&#13;&#10;    '    select ' +&#13;&#10;    '    o.usr$pay, count(o.documentkey) as  countchek, ' +&#13;&#10;    '    sum(o.usr$guestcount) as guestcount ' +&#13;&#10;    '    from ' +&#13;&#10;    '    usr$mn_order o ' +&#13;&#10;    '     ' +&#13;&#10;    '    where o.usr$logicdate &#62;= :datebegin ' +&#13;&#10;    '    and o.usr$logicdate &#60;= :dateend ' +&#13;&#10;    '    group by  o.usr$pay ' +&#13;&#10;    '    order by o.usr$pay desc ';&#13;&#10;  Q.ParamByName('datebegin').AsDateTime := DateBegin;&#13;&#10;  Q.ParamByName('dateend').AsDateTime := DateEnd;&#13;&#10;  Q.Open;&#13;&#10;&#13;&#10;      &#13;&#10;  P := BaseQuery.Query[BaseQuery.Add('P' , False)];&#13;&#10;  P.SQL :=&#13;&#10;    '    select ' +&#13;&#10;    '      o.usr$pay, pt.usr$name as typepay, ' +&#13;&#10;    '      kt.usr$name as kindpay, ' +&#13;&#10;    '      sum(p.usr$sumncu) as sumpayncu ' +&#13;&#10;    '      from ' +&#13;&#10;    '      usr$mn_payment p ' +&#13;&#10;    '      LEFT join usr$mn_order o on o.documentkey = p.usr$orderkey ' +&#13;&#10;    '      LEFT join USR$MN_KINDTYPE kt on kt.id = p.usr$paykindkey ' +&#13;&#10;    '      LEFT join USR$INV_PAYTYPE pt on pt.id = kt.usr$paytypekey ' +&#13;&#10;    '      where o.usr$logicdate &#62;= :datebegin ' +&#13;&#10;    '      and o.usr$logicdate &#60;= :dateend and o.usr$pay = 1 ' +&#13;&#10;    '      group by o.usr$pay, kt.usr$name, pt.usr$name ';&#13;&#10;  P.ParamByName('datebegin').AsDateTime := DateBegin;&#13;&#10;  P.ParamByName('dateend').AsDateTime := DateEnd;&#13;&#10;  P.Open;&#13;&#10;&#13;&#10;  &#13;&#10;  Np := BaseQuery.Query[BaseQuery.add('Np' , False)];&#13;&#10;  Np.SQL := ' select o.usr$pay, sum(ol.usr$sumncuwithdiscount) as sumncu from usr$mn_order o ' +&#13;&#10;    ' join usr$mn_orderline ol on ol.masterkey = o.documentkey ' +&#13;&#10;    '      where o.usr$logicdate &#62;= :datebegin ' +&#13;&#10;    '      and o.usr$logicdate &#60;= :dateend and o.usr$pay + 0 = 0' +&#13;&#10;    '      and ol.usr$causedeletekey + 0 is null ' +&#13;&#10;    ' group by o.usr$pay ';&#13;&#10;  Np.ParamByName('datebegin').AsDateTime := DateBegin;&#13;&#10;  Np.ParamByName('dateend').AsDateTime := DateEnd;&#13;&#10;  Np.Open;&#13;&#10;      &#13;&#10;  Header := BaseQuery.Query[BaseQuery.Add('Header', True)];&#13;&#10;  Header.AddField('PAY', 'ftInteger', 0, False);&#13;&#10;  Header.AddField('c', 'ftFloat', 0, False);&#13;&#10;  Header.AddField('g', 'ftFloat', 0, False);&#13;&#10;  Header.AddField('t', 'ftString', 60, False);&#13;&#10;  Header.AddField('K', 'ftString', 60, False);&#13;&#10;  Header.AddField('p', 'ftFloat', 0, False);&#13;&#10;  Header.AddField('np', 'ftFloat', 0, False);&#13;&#10;  Header.AddField('PS', 'ftString', 20, False);&#13;&#10;  Header.AddField('COMPANY', 'ftString', 60, False);&#13;&#10;  Header.AddField('Db', 'ftDate', 0, False);&#13;&#10;  Header.AddField('De', 'ftDate', 0, False);&#13;&#10;  Header.AddField('Time', 'ftDateTime', 0, False);&#13;&#10;  Header.Open;&#13;&#10;&#13;&#10;  while not Q.eof do&#13;&#10;  begin&#13;&#10;    Header.Append;&#13;&#10;    Header.FieldByNAme('COMPANY').AsString := &#60;CompanyName&#62;;     &#13;&#10;    Header.FieldByNAme('Db').AsDateTime := DateBegin;&#13;&#10;    Header.FieldByNAme('De').AsDateTime := DateEnd;&#13;&#10;    Header.FieldByNAme('Time').AsVariant := Now;&#13;&#10;&#13;&#10;    I := 0;&#13;&#10;    while I &#60;= Q.FieldCount - 1 do&#13;&#10;    begin&#13;&#10;      Header.Fields(I).AsString := Q.Fields(I).AsString;&#13;&#10;      I := I + 1;                                        &#13;&#10;    end;&#13;&#10;    if Q.FieldByName('usr$pay').AsCurrency &#60;&#62; 1 then&#13;&#10;    begin&#13;&#10;      Header.Edit;&#13;&#10;      Header.FieldByName('PS').AsString := 'Не опл';&#13;&#10;    end else&#13;&#10;    begin&#13;&#10;      Header.Edit;&#13;&#10;      Header.FieldByName('PS').AsString := 'Оплач';&#13;&#10;    end;&#13;&#10;    while not P.eof do&#13;&#10;    begin&#13;&#10;      Header.Append;&#13;&#10;      Header.FieldByName('t').AsString := P.FieldByName('typepay').AsString;&#13;&#10;      Header.FieldByName('k').AsString := P.FieldByName('kindpay').AsString;&#13;&#10;      Header.FieldByName('p').AsCurrency := P.FieldByName('sumpayncu').AsCurrency;&#13;&#10;      P.Next;&#13;&#10;    end;&#13;&#10;    if Q.FieldByName('usr$pay').AsCurrency &#60;&#62; 1 then&#13;&#10;    begin&#13;&#10;      Header.Edit;&#13;&#10;      Header.FieldByName('p').AsCurrency := Np.FieldByName('sumncu').AsCurrency;&#13;&#10;    end;&#13;&#10;&#13;&#10;    Header.Post;&#13;&#10;    Q.Next;&#13;&#10;  end;      &#13;&#10;  &#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." ShowProgress="False" OnBeforeReportPrint="OnBeforeReportPrint" PropData="0844617461736574730100095661726961626C657301010612204E616D653D222052657374506172616D2200010626204E616D653D2244617465426567696E222056616C75653D222731342E30362E32303131272200010624204E616D653D2244617465456E64222056616C75653D222731342E30362E3230313127220001148C000000204E616D653D22436F6D70616E794E616D65222056616C75653D2227D09AD0B0D184D0B52020D090D0BCD181D182D0B5D180D0B4D0B0D0BC20D0A4D0B8D0BBD0B8D0B0D0BB20D09ED09ED09E20262333343BD0A2D0B0D0B1D0B0D0BA2DD0B8D0BDD0B2D0B5D181D182262333343B20D0A2D0A620262333343BD09AD0BED180D0BED0BDD0B0262333343B27220000055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000"/>
  <TfrxDMPPage Name="Page1" PaperWidth="99.0599360237913" PaperHeight="296.862308276426" PaperSize="256" LeftMargin="2.53999835958439" RightMargin="2.53999835958439" TopMargin="4.49791376176403" BottomMargin="4.49791376176403" ColumnWidth="0" ColumnPositions.Text="" HGuides.Text="" VGuides.Text="" FontStyle="0">
    <TfrxReportTitle Name="ReportTitle1" Height="119" Left="0" Top="17" Width="355.2">
      <TfrxDMPMemoView Name="DMPMemo1" Left="0" Top="34" Width="355.2" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="Отчет по выручке"/>
      <TfrxDMPMemoView Name="DMPMemo2" Left="0" Top="51" Width="355.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="за период с [DateBegin] по [DateEnd]"/>
      <TfrxDMPMemoView Name="DMPMemo3" Left="0" Top="68" Width="355.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="распечатан [Date] [Time]"/>
      <TfrxDMPMemoView Name="HEADERCOMPANY" Left="0" Top="85" Width="355.2" Height="34" ShowHint="False" DataField="COMPANY" DataSetName="Header" HAlign="haCenter" TruncOutboundText="False" Text="[Header.&#34;COMPANY&#34;]"/>
      <TfrxDMPCommand Name="DMPCommand1" Description="Reset Printer" Left="0" Top="0" Width="355.2" Height="17" Hint="Reset Printer" ShowHint="False" Command="1B40"/>
      <TfrxDMPCommand Name="DMPCommand2" Description="Bell" Left="0" Top="17" Width="355.2" Height="17" Hint="Bell" ShowHint="False" Command="1B70300000"/>
    </TfrxReportTitle>
    <TfrxMasterData Name="MasterData1" Height="17" Left="0" Top="204" Width="355.2" ColumnWidth="0" ColumnGap="0" DataSetName="HEADER" RowCount="0">
      <TfrxDMPMemoView Name="HEADERPS" Left="0" Top="0" Width="67.2" Height="17" ShowHint="False" DataField="PS" DataSetName="Header" TruncOutboundText="False" Text="[Header.&#34;PS&#34;]"/>
      <TfrxDMPMemoView Name="Memo1" Left="67.2" Top="0" Width="38.4" Height="17" ShowHint="False" DataField="c" DataSetName="Header" HAlign="haCenter" TruncOutboundText="False" Text="[Header.&#34;c&#34;]"/>
      <TfrxDMPMemoView Name="Memo2" Left="105.6" Top="0" Width="57.6" Height="17" ShowHint="False" DataField="g" DataSetName="Header" HAlign="haCenter" TruncOutboundText="False" Text="[Header.&#34;g&#34;]"/>
      <TfrxDMPMemoView Name="Memo3" Left="163.2" Top="0" Width="76.8" Height="17" ShowHint="False" DataField="t" DataSetName="Header" TruncOutboundText="False" Text="[Header.&#34;t&#34;]"/>
      <TfrxDMPMemoView Name="Memo4" Left="240" Top="0" Width="57.6" Height="17" ShowHint="False" DataField="K" DataSetName="Header" TruncOutboundText="False" Text="[Header.&#34;K&#34;]"/>
      <TfrxDMPMemoView Name="Memo5" Left="297.6" Top="0" Width="57.6" Height="17" ShowHint="False" DataField="p" DataSetName="Header" HAlign="haRight" TruncOutboundText="False" Text="[Header.&#34;p&#34;]"/>
    </TfrxMasterData>
    <TfrxHeader Name="Header1" Height="17" Left="0" Top="170" Width="355.2">
      <TfrxDMPMemoView Name="DMPMemo4" Left="67.2" Top="0" Width="38.4" Height="17" ShowHint="False" TruncOutboundText="False" Text="Чеки"/>
      <TfrxDMPMemoView Name="DMPMemo5" Left="105.6" Top="0" Width="57.6" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="Гости"/>
      <TfrxDMPMemoView Name="DMPMemo6" Left="297.6" Top="0" Width="57.6" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="Сумма"/>
    </TfrxHeader>
    <TfrxReportSummary Name="ReportSummary1" Height="136" Left="0" Top="289" Width="355.2">
      <TfrxDMPCommand Name="DMPCommand3" Description="Page Break" Left="0" Top="119" Width="355.2" Height="17" Hint="Page Break" ShowHint="False" Command="1D5601"/>
    </TfrxReportSummary>
    <TfrxFooter Name="Footer1" Height="17" Left="0" Top="238" Width="355.2">
      <TfrxDMPMemoView Name="DMPMemo7" Left="0" Top="0" Width="96" Height="17" ShowHint="False" TruncOutboundText="False" Text="Итого"/>
      <TfrxDMPMemoView Name="DMPMemo8" Left="259.2" Top="0" Width="96" Height="17" ShowHint="False" HAlign="haRight" TruncOutboundText="False" Text="[SUM(&#60;HEADER.&#34;p&#34;&#62;,MasterData1)]"/>
    </TfrxFooter>
  </TfrxDMPPage>
</Tgs_fr4SingleReport>
