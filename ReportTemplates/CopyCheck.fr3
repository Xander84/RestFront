<?xml version="1.0" encoding="utf-8" standalone="no"?>
<Tgs_fr4SingleReport Version="4.8.2" DotMatrixReport="False" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="Default" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="40488.7675301157" ReportOptions.Description.Text="" ReportOptions.LastChange="40708.7301478125" ScriptLanguage="PascalScript" ScriptText.Text="procedure OnBeforeReportPrint(Sender: TfrxComponent);&#13;&#10;var&#13;&#10;  MemTable, Header1: TgsDataSet;&#13;&#10;  DateBegin, DateEnd: TDate;&#13;&#10;  BaseQuery: QueryList;&#13;&#10;  DocDate: TDate;&#13;&#10;  NomPP, DocKey, I: Integer;                                         &#13;&#10;begin&#13;&#10;  DateBegin := StrToDate(&#60;DateBegin&#62;);                           &#13;&#10;  DateEnd := StrToDate(&#60;DateEnd&#62;);&#13;&#10;&#13;&#10;  BaseQuery := GetQueryList;&#13;&#10;  BaseQuery.Clear;&#13;&#10;&#13;&#10;  Header1 := BaseQuery.Query[BaseQuery.Add('Header1', False)];      &#13;&#10;  Header1.SQL :=&#13;&#10;    '  select ' +&#13;&#10;    '    comp.name as compname, ' +&#13;&#10;    '    comp.address as compadr, ' +&#13;&#10;    '    comp.city compcity, ' +&#13;&#10;    '    g.name as goodname, ' +&#13;&#10;    '    ol.usr$costncu as c, ' +&#13;&#10;    '    con.name as conname, ' +&#13;&#10;    '    doc.id, doc.documentdate as docdate, doc.number as docnum, ' +&#13;&#10;    '    o.usr$guestcount as guest, o.usr$timeorder as open1, ' +&#13;&#10;    '    o.usr$timecloseorder as close1, ' +&#13;&#10;    '    o.usr$cash as cash, ' +&#13;&#10;    '    d.usr$surname as surname, ' +&#13;&#10;    '    d.usr$middlename as midle, ' +&#13;&#10;    '    d.usr$firstname as firstn, ' +&#13;&#10;    '    d.usr$cardnum as cardnum, ' +&#13;&#10;    '    sum(ol.usr$sumncu) s,  ' +&#13;&#10;    '    sum(ol.usr$sumncuwithdiscount) swd,  ' +&#13;&#10;    '    sum(ol.usr$sumdiscount) sd, ' +&#13;&#10;    '    sum(ol.usr$quantity) q ' +&#13;&#10;    '  from  ' +&#13;&#10;    '    usr$mn_order o ' +&#13;&#10;    '    left join gd_document doc on o.documentkey = doc.id ' +&#13;&#10;    '    left join usr$mn_orderline ol on ol.masterkey = o.documentkey ' +&#13;&#10;    '    left join gd_good g on g.id = ol.usr$goodkey  ' +&#13;&#10;    '    left join gd_contact comp on comp.id = doc.companykey ' +&#13;&#10;    '    left join gd_contact con on con.id = o.usr$respkey  ' +&#13;&#10;    '    left join usr$mn_discountcard d on d.id = o.usr$disccardkey ' +&#13;&#10;    '  where ' +&#13;&#10;    '    ol.usr$causedeletekey + 0 is null  ' +&#13;&#10;    '    and o.usr$logicdate &#62;= :BeginDate  ' +&#13;&#10;    '    and o.usr$logicdate &#60;= :EndDate and o.usr$pay = 1 ' +&#13;&#10;    '  group by  ' +&#13;&#10;    '    1, 2, 3, 4, 5, 6, 7, 8, ' +&#13;&#10;    '    9, 10, 11, 12, 13, 14, 15, 16, 17 ' +&#13;&#10;    '  having  ' +&#13;&#10;    '    sum(ol.usr$quantity) &#62; 0  ' +&#13;&#10;    '  order by ' +&#13;&#10;    '    doc.documentdate, o.usr$timecloseorder, doc.id ';&#13;&#10;  Header1.ParamByName('begindate').AsDate := DateBegin;&#13;&#10;  Header1.ParamByName('enddate').AsDate := DateEnd;&#13;&#10;  Header1.Open;&#13;&#10;&#13;&#10;  MemTable := BaseQuery.Query[BaseQuery.Add('HEADER', True)];                &#13;&#10;  MemTable.CreateDataSetAs(Header1);&#13;&#10;  MemTable.AddField('NomPP', 'ftInteger', 0, False);&#13;&#10;  MemTable.AddField('DISKN', 'ftString', 60, False);                                                                                             &#13;&#10;  MemTable.Open;&#13;&#10;&#13;&#10;  DocDate := EncodeDate(2000, 1, 1);&#13;&#10;  NomPP := 1;&#13;&#10;  DocKey := -1;&#13;&#10;  Header1.First;&#13;&#10;  while not Header1.Eof do&#13;&#10;  begin&#13;&#10;    I := 0;&#13;&#10;    MemTable.Append;&#13;&#10;    while I &#60;= Header1.FieldCount - 1 do&#13;&#10;    begin&#13;&#10;      MemTable.Fields(I).AsString := Header1.Fields(I).AsString;&#13;&#10;      I := I + 1;                                      &#13;&#10;    end;&#13;&#10;&#13;&#10;    if DocKey &#60;&#62; MemTable.FieldbyName('ID').AsInteger then&#13;&#10;    begin&#13;&#10;      DocKey := MemTable.FieldbyName('ID').AsInteger;&#13;&#10;      NomPP := NomPP + 1;                        &#13;&#10;    end;&#13;&#10;    if DocDate &#60;&#62; MemTable.FieldbyName('docdate').AsDateTime then&#13;&#10;    begin&#13;&#10;      DocDate := MemTable.FieldbyName('docdate').AsDateTime;&#13;&#10;      NomPP := 1;&#13;&#10;    end;&#13;&#10;    MemTable.FieldbyName('NomPP').AsInteger := NomPP;&#13;&#10;    if Header1.FieldByName('surname').AsString &#60;&#62; '' then&#13;&#10;    begin&#13;&#10;      MemTable.FieldByNAme('DISKN').AsString := 'Карточка:' + Header1.FieldByName('cardnum').AsString +&#13;&#10;        #13#10 + Header1.FieldByName('surname').AsString + ' ' +&#13;&#10;        Header1.FieldByName('firstn').AsString + ' ' + Header1.FieldByName('midle').AsString;&#13;&#10;    end;&#13;&#10;    MemTable.Post;&#13;&#10;&#13;&#10;    Header1.Next;&#13;&#10;  end;      &#13;&#10;    &#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." ShowProgress="False" OnBeforeReportPrint="OnBeforeReportPrint" PropData="0844617461736574730100095661726961626C657301010612204E616D653D222052657374506172616D2200010626204E616D653D2244617465426567696E222056616C75653D222731342E30362E32303131272200010624204E616D653D2244617465456E64222056616C75653D222731342E30362E3230313127220001148C000000204E616D653D22436F6D70616E794E616D65222056616C75653D2227D09AD0B0D184D0B52020D090D0BCD181D182D0B5D180D0B4D0B0D0BC20D0A4D0B8D0BBD0B8D0B0D0BB20D09ED09ED09E20262333343BD0A2D0B0D0B1D0B0D0BA2DD0B8D0BDD0B2D0B5D181D182262333343B20D0A2D0A620262333343BD09AD0BED180D0BED0BDD0B0262333343B27220000055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000"/>
  <TfrxReportPage Name="Page1" PaperWidth="72" PaperHeight="297" PaperSize="120" LeftMargin="3" RightMargin="0" TopMargin="1" BottomMargin="1" ColumnWidth="0" ColumnPositions.Text="" HGuides.Text="" VGuides.Text="">
    <TfrxMasterData Name="MasterData1" Height="18.89765" Left="0" Top="185.19697" Width="260.78757" ColumnWidth="0" ColumnGap="0" DataSetName="HEADER" RowCount="0" Stretched="True">
      <TfrxMemoView Name="Memo13" Left="185.19697" Top="0" Width="34.01577" Height="18.89765" ShowHint="False" StretchMode="smMaxHeight" DataField="Q" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[HEADER.&#34;Q&#34;]"/>
      <TfrxMemoView Name="Memo9" Left="0" Top="0" Width="143.62214" Height="18.89765" ShowHint="False" StretchMode="smMaxHeight" DataField="GOODNAME" DataSetName="HEADER" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" ParentFont="False" VAlign="vaCenter" Text="[HEADER.&#34;GOODNAME&#34;]"/>
      <TfrxMemoView Name="Memo15" Left="143.62214" Top="0" Width="41.57483" Height="18.89765" ShowHint="False" StretchMode="smMaxHeight" DataField="C" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[HEADER.&#34;C&#34;]"/>
      <TfrxMemoView Name="Memo17" Left="219.21274" Top="0" Width="45.35436" Height="18.89765" ShowHint="False" StretchMode="smMaxHeight" DataField="S" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[HEADER.&#34;S&#34;]"/>
    </TfrxMasterData>
    <TfrxGroupHeader Name="GroupHeader1" Height="143.62214" Left="0" Top="18.89765" Width="260.78757" Condition="HEADER.&#34;ID&#34;" StartNewPage="True">
      <TfrxMemoView Name="Memo1" Left="0" Top="0" Width="264.5671" Height="26.45671" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[HEADER.&#34;COMPNAME&#34;]&#13;&#10;[HEADER.&#34;COMPADR&#34;]"/>
      <TfrxMemoView Name="Memo2" Left="0" Top="26.45671" Width="264.5671" Height="30.23624" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-21" Font.Name="Arial" Font.Style="1" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="С Ч Ё Т   № [HEADER.&#34;NomPP&#34;]"/>
      <TfrxMemoView Name="Memo4" Left="0" Top="75.5906" Width="75.5906" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="Дата: [HEADER.&#34;DOCDATE&#34;]"/>
      <TfrxMemoView Name="Memo5" Left="0" Top="56.69295" Width="75.5906" Height="18.89765" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="Стол №:"/>
      <TfrxMemoView Name="Memo6" Left="83.14966" Top="75.5906" Width="86.92919" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="Открыт : [HEADER.&#34;OPEN1&#34;]"/>
      <TfrxMemoView Name="Memo7" Left="79.37013" Top="56.69295" Width="185.19697" Height="18.89765" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-19" Font.Name="Arial" Font.Style="1" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[HEADER.&#34;DOCNUM&#34;]"/>
      <TfrxMemoView Name="Memo3" Left="0" Top="90.70872" Width="204.09462" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="Официант:[HEADER.&#34;CONNAME&#34;]"/>
      <TfrxMemoView Name="Memo8" Left="204.09462" Top="90.70872" Width="60.47248" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" HAlign="haRight" ParentFont="False" Text="Гостей: [HEADER.&#34;GUEST&#34;]"/>
      <TfrxMemoView Name="Memo14" Left="170.07885" Top="75.5906" Width="94.48825" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" HAlign="haRight" ParentFont="False" Text="Закрыт : [HEADER.&#34;CLOSE1&#34;]"/>
      <TfrxMemoView Name="Memo10" Left="0" Top="105.82684" Width="143.62214" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" Frame.Typ="12" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Наименование блюда"/>
      <TfrxMemoView Name="Memo11" Left="185.19697" Top="105.82684" Width="34.01577" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" Frame.Typ="12" GapX="0" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Кол-во"/>
      <TfrxMemoView Name="Memo12" Left="143.62214" Top="105.82684" Width="41.57483" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" Frame.Typ="12" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Цена"/>
      <TfrxMemoView Name="Memo16" Left="219.21274" Top="105.82684" Width="45.35436" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" Frame.Typ="12" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Сумма"/>
    </TfrxGroupHeader>
    <TfrxGroupFooter Name="GroupFooter1" Height="90.70872" Left="0" Top="226.7718" Width="260.78757">
      <TfrxMemoView Name="Memo18" Left="0" Top="2.77555756156289E-17" Width="75.5906" Height="18.89765" ShowHint="False" DataSetName="HEADER" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="12" Frame.TopLine.Width="2" Frame.BottomLine.Width="0.5" ParentFont="False" VAlign="vaCenter" Text=" Сумма :"/>
      <TfrxMemoView Name="Memo19" Left="75.5906" Top="0" Width="188.9765" Height="18.89765" ShowHint="False" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="12" Frame.TopLine.Width="2" Frame.BottomLine.Width="0.5" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[SUM(&#60;HEADER.&#34;S&#34;&#62;)] "/>
      <TfrxMemoView Name="Memo20" Left="0" Top="18.89765" Width="75.5906" Height="18.89765" ShowHint="False" DataSetName="HEADER" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" ParentFont="False" VAlign="vaCenter" Text=" Скидка :"/>
      <TfrxMemoView Name="Memo21" Left="75.5906" Top="18.89765" Width="188.9765" Height="18.89765" ShowHint="False" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[SUM(&#60;HEADER.&#34;SD&#34;&#62;)] "/>
      <TfrxMemoView Name="Memo22" Left="0" Top="37.7953" Width="113.3859" Height="37.7953" ShowHint="False" DataSetName="HEADER" Font.Charset="1" Font.Color="0" Font.Height="-16" Font.Name="Arial" Font.Style="1" Frame.Typ="12" Frame.Width="2" ParentFont="False" VAlign="vaCenter" Text=" В С Е Г О :"/>
      <TfrxMemoView Name="Memo23" Left="113.3859" Top="37.7953" Width="151.1812" Height="37.7953" ShowHint="False" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-16" Font.Name="Arial" Font.Style="1" Frame.Typ="12" Frame.Width="2" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[SUM(&#60;HEADER.&#34;SWD&#34;&#62;)] "/>
      <TfrxMemoView Name="Memo27" Left="0" Top="75.5906" Width="264.5671" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[HEADER.&#34;DISKN&#34;]"/>
    </TfrxGroupFooter>
  </TfrxReportPage>
</Tgs_fr4SingleReport>
