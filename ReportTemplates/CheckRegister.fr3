<?xml version="1.0" encoding="utf-8" standalone="no"?>
<Tgs_fr4SingleReport Version="4.8.2" DotMatrixReport="True" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="По умолчанию" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="40584.6157234838" ReportOptions.Description.Text="" ReportOptions.LastChange="40708.7297911227" ScriptLanguage="PascalScript" ScriptText.Text="procedure OnBeforeReportPrint(Sender: TfrxComponent);&#13;&#10;var&#13;&#10;  MemTable, Header1, Buh: TgsDataSet;&#13;&#10;  DateBegin, DateEnd: TDate;&#13;&#10;  BaseQuery: QueryList;&#13;&#10;  DocDate: TDate;&#13;&#10;  NomPP, DocKey, I: Integer;      &#13;&#10;begin&#13;&#10;  DateBegin := StrToDate(&#60;DateBegin&#62;);                           &#13;&#10;  DateEnd := StrToDate(&#60;DateEnd&#62;);&#13;&#10;&#13;&#10;  BaseQuery := GetQueryList;&#13;&#10;  BaseQuery.Clear;&#13;&#10;&#13;&#10;  Buh := BaseQuery.Query[BaseQuery.Add('Buh', False)];&#13;&#10;  Buh.SQL :=&#13;&#10;    'select ' +&#13;&#10;    '  con.name, p.rank ' +&#13;&#10;    'from ' +&#13;&#10;    '  gd_contact con ' +&#13;&#10;    '  left join gd_people p on con.id = p.contactkey ' +&#13;&#10;    'where ' +&#13;&#10;    '  id = :id ';&#13;&#10;  Buh.ParamByName('ID').AsInteger := StrToInt(&#60;EmplKey&#62;);                         &#13;&#10;  Buh.Open;      &#13;&#10;&#13;&#10;  Header1 := BaseQuery.Query[BaseQuery.Add('Header1', False)];&#13;&#10;  Header1.SQL :=&#13;&#10;    'SELECT w.name, w.id, doc.documentdate, o.usr$timecloseorder, o.documentkey, sum(ol.usr$sumncuwithdiscount) sumcheck ' +&#13;&#10;    ' ' +&#13;&#10;    'FROM usr$mn_order o ' +&#13;&#10;    '  left join usr$mn_orderline ol on o.documentkey = ol.masterkey ' +&#13;&#10;    '  left join gd_contact w on w.id = o.usr$respkey ' +&#13;&#10;    '  left join gd_document doc on o.documentkey = doc.id ' +&#13;&#10;    'WHERE ' +&#13;&#10;    '  o.usr$logicdate &#62;= :begindate  ' +&#13;&#10;    '  and o.usr$logicdate &#60;= :enddate  ' +&#13;&#10;    '  and o.usr$pay = 1 ' +&#13;&#10;    '  and o.usr$respkey = :respkey ' +&#13;&#10;    'GROUP BY 1, 2, 3, 4, 5  ' +&#13;&#10;    'ORDER BY ' +&#13;&#10;    'doc.documentdate, o.usr$timecloseorder, w.name, o.documentkey ';&#13;&#10;  Header1.ParamByName('begindate').AsDate := DateBegin;&#13;&#10;  Header1.ParamByName('enddate').AsDate := DateEnd;&#13;&#10;  Header1.ParamByName('respkey').AsInteger := StrToInt(&#60;RespKey&#62;);&#13;&#10;  Header1.Open;&#13;&#10;&#13;&#10;  MemTable := BaseQuery.Query[BaseQuery.Add('HEADER', True)];&#13;&#10;  MemTable.CreateDataSetAs(Header1);&#13;&#10;  MemTable.AddField('NomPP', 'ftInteger', 0, False);&#13;&#10;  MemTable.AddField('CompanyName', 'ftString', 255, False);&#13;&#10;  MemTable.Open;&#13;&#10;&#13;&#10;  DocDate := EncodeDate(2000, 1, 1);&#13;&#10;  NomPP := 1;&#13;&#10;  DocKey := -1;&#13;&#10;  Header1.First;&#13;&#10;&#13;&#10;  while not Header1.Eof do&#13;&#10;  begin&#13;&#10;    MemTable.Append;&#13;&#10;    MemTable.FieldbyName('CompanyName').AsString := &#60;CompanyName&#62;;     &#13;&#10;    I := 0;&#13;&#10;    while I &#60;= Header1.FieldCount - 1 do&#13;&#10;    begin&#13;&#10;      MemTable.Fields(I).AsString := Header1.Fields(I).AsString;&#13;&#10;      I := I + 1;                                     &#13;&#10;    end;&#13;&#10;    if DocKey &#60;&#62; MemTable.FieldbyName('documentkey').AsInteger then&#13;&#10;    begin&#13;&#10;      DocKey := MemTable.FieldbyName('documentkey').AsInteger;&#13;&#10;      NomPP := NomPP + 1;                          &#13;&#10;    end;&#13;&#10;    if DocDate &#60;&#62; MemTable.FieldbyName('documentdate').AsDateTime then&#13;&#10;    begin&#13;&#10;      DocDate := MemTable.FieldbyName('documentdate').AsDateTime;&#13;&#10;      NomPP := 1;&#13;&#10;    end;&#13;&#10;    MemTable.FieldbyName('NomPP').AsInteger := NomPP;&#13;&#10;    MemTable.Post;&#13;&#10;&#13;&#10;    Header1.Next;&#13;&#10;  end;&#13;&#10;  MemTable.IndexFields := 'documentdate;NAME;nompp';      &#13;&#10;  &#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." ShowProgress="False" OnBeforeReportPrint="OnBeforeReportPrint" PropData="0844617461736574730100095661726961626C657301010612204E616D653D222052657374506172616D2200010626204E616D653D2244617465426567696E222056616C75653D222731342E30362E32303131272200010624204E616D653D2244617465456E64222056616C75653D222731342E30362E3230313127220001061B204E616D653D22456D706C4B6579222056616C75653D22273027220001061B204E616D653D22526573704B6579222056616C75653D22273027220001148C000000204E616D653D22436F6D70616E794E616D65222056616C75653D2227D09AD0B0D184D0B52020D090D0BCD181D182D0B5D180D0B4D0B0D0BC20D0A4D0B8D0BBD0B8D0B0D0BB20D09ED09ED09E20262333343BD0A2D0B0D0B1D0B0D0BA2DD0B8D0BDD0B2D0B5D181D182262333343B20D0A2D0A620262333343BD09AD0BED180D0BED0BDD0B0262333343B27220000055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000"/>
  <TfrxDMPPage Name="Page1" PaperWidth="99.0599360237913" PaperHeight="296.862308276426" PaperSize="256" LeftMargin="2.53999835958439" RightMargin="2.53999835958439" TopMargin="4.49791376176403" BottomMargin="4.49791376176403" ColumnWidth="0" ColumnPositions.Text="" HGuides.Text="" VGuides.Text="" FontStyle="0">
    <TfrxReportTitle Name="ReportTitle1" Height="187" Left="0" Top="17" Width="355.2">
      <TfrxDMPMemoView Name="DMPMemo1" Left="0" Top="51" Width="355.2" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text=" РЕЕСТР СЧЕТОВ"/>
      <TfrxDMPMemoView Name="DMPMemo2" Left="0" Top="68" Width="355.2" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="за [HEADER.&#34;DOCUMENTDATE&#34;]"/>
      <TfrxDMPCommand Name="DMPCommand1" Description="Reset Printer" Left="0" Top="0" Width="355.2" Height="17" Hint="Reset Printer" ShowHint="False" Command="1B40"/>
      <TfrxDMPMemoView Name="DMPMemo13" Left="0" Top="17" Width="355.2" Height="34" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="[HEADER.&#34;CompanyName&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo3" Left="0" Top="85" Width="355.2" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="сдачи счетов официантом (барменом)"/>
      <TfrxDMPMemoView Name="DMPMemo4" Left="0" Top="102" Width="355.2" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="   [HEADER.&#34;NAME&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo5" Left="0" Top="119" Width="355.2" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="Метрдотель или уполномоченное лицо"/>
      <TfrxDMPMemoView Name="DMPMemo9" Left="0" Top="136" Width="355.2" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="   [BUH.&#34;NAME&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo10" Left="0" Top="170" Width="96" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" VAlign="vaCenter" Text="№ п/п"/>
      <TfrxDMPMemoView Name="DMPMemo11" Left="96" Top="170" Width="105.6" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" VAlign="vaCenter" Text="№ счета"/>
      <TfrxDMPMemoView Name="DMPMemo12" Left="201.6" Top="170" Width="134.4" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" VAlign="vaCenter" Text="Сумма"/>
    </TfrxReportTitle>
    <TfrxMasterData Name="MasterData1" Height="17" Left="0" Top="238" Width="355.2" ColumnWidth="0" ColumnGap="0" DataSetName="HEADER" RowCount="0">
      <TfrxDMPMemoView Name="DMPMemo6" Left="0" Top="0" Width="96" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="[LINE#]"/>
      <TfrxDMPMemoView Name="DMPMemo7" Left="96" Top="0" Width="105.6" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="[HEADER.&#34;NomPP&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo8" Left="201.6" Top="0" Width="134.4" Height="17" ShowHint="False" HAlign="haRight" TruncOutboundText="False" Text="[HEADER.&#34;SUMCHECK&#34;]"/>
    </TfrxMasterData>
    <TfrxReportSummary Name="ReportSummary1" Height="136" Left="0" Top="289" Width="355.2">
      <TfrxDMPMemoView Name="DMPMemo14" Left="0" Top="17" Width="355.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="Официант (бармен)     ___________"/>
      <TfrxDMPMemoView Name="DMPMemo15" Left="0" Top="34" Width="355.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="   [HEADER.&#34;NAME&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo16" Left="0" Top="68" Width="345.6" Height="34" ShowHint="False" TruncOutboundText="False" Text="Принял метрдотель или уполномоченное лицо                  ___________"/>
      <TfrxDMPMemoView Name="DMPMemo17" Left="0" Top="102" Width="355.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="   [BUH.&#34;NAME&#34;]"/>
    </TfrxReportSummary>
  </TfrxDMPPage>
</Tgs_fr4SingleReport>
