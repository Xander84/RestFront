<?xml version="1.0" encoding="utf-8" standalone="no"?>
<Tgs_fr4SingleReport Version="4.8.2" DotMatrixReport="True" EngineOptions.DoublePass="True" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="По умолчанию" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="39770.5769802431" ReportOptions.Description.Text="" ReportOptions.LastChange="40708.7289325579" ScriptLanguage="PascalScript" ScriptText.Text="procedure OnBeforeReportPrint(Sender: TfrxComponent);&#13;&#10;var&#13;&#10;  MemTable, Query: TgsDataSet;&#13;&#10;  BaseQuery: QueryList;&#13;&#10;  PrnGrID, DocID: Integer;&#13;&#10;  S: String;&#13;&#10;  Bold, EndBold, DOUBLESIZE, ENDDOUBLESIZE: String;&#13;&#10;  LineKey, I: Integer;                           &#13;&#10;begin&#13;&#10;  PrnGrID := StrToInt(&#60;PrnGrID&#62;);&#13;&#10;  DocID := StrToInt(&#60;DocID&#62;);                                          &#13;&#10;&#13;&#10;  BaseQuery := GetQueryList;&#13;&#10;  BaseQuery.Clear;&#13;&#10;                           &#13;&#10;  S :=&#13;&#10;    'select ' +&#13;&#10;    '  doc.documentdate, ' +&#13;&#10;    '  doc.number as NUM, ' +&#13;&#10;    '  comp.name compname, ' +&#13;&#10;    '  o.usr$guestcount guest,  ' +&#13;&#10;    '  con.name conname,        ' +&#13;&#10;    '  o.usr$timeorder as open1, ' +&#13;&#10;    '  g.alias,                  ' +&#13;&#10;    '  g.name as goodname,         ' +&#13;&#10;    '  prngr.usr$name as prngroupname,  ' +&#13;&#10;    '  setprn.usr$printername as printername,  ' +&#13;&#10;    '  '' *** '' || m.usr$name || '' ***'' as modifyname,  ' +&#13;&#10;    '  ol.documentkey as documentkey, ' +&#13;&#10;    '  ol.usr$quantity as q,           ' +&#13;&#10;    '  ol.usr$extramodify as extramodify, ' +&#13;&#10;    '  current_time as time1          ' +&#13;&#10;    'from                             ' +&#13;&#10;    '  gd_document doc                ' +&#13;&#10;    '  join usr$mn_order o on doc.id = o.documentkey and doc.id = :docid  ' +&#13;&#10;    '    and doc.usr$mn_printdate is null   ' +&#13;&#10;    '  join usr$mn_orderline ol on o.documentkey = ol.masterkey ' +&#13;&#10;    '  join gd_document docl on docl.id = ol.documentkey ' +&#13;&#10;    '     and docl.usr$mn_printdate is null  ' +&#13;&#10;    '  join gd_good g on g.id = ol.usr$goodkey  ' +&#13;&#10;    '  join usr$mn_prngroup prngr on prngr.id = g.usr$prngroupkey  ' +&#13;&#10;    '  join usr$mn_prngroupset setprn on setprn.usr$prngroup = prngr.id ' +&#13;&#10;    '  JOIN gd_contact comp ON comp.id = doc.companykey ' +&#13;&#10;    '  left join usr$cross509_157767346 cr on cr.usr$mn_orderlinekey = ol.documentkey  ' +&#13;&#10;    '  left join usr$mn_modify m on m.id = cr.usr$mn_modifykey ' +&#13;&#10;    '  LEFT JOIN usr$mn_p_getcontact_department(o.usr$respkey) cd ON 0 = 0  ' +&#13;&#10;    '  LEFT JOIN gd_contact con ON con.id = cd.peoplekey ' +&#13;&#10;    '  LEFT JOIN gd_contact dept ON dept.id = cd.departmentkey ' +&#13;&#10;    'where   ' +&#13;&#10;    '  setprn.usr$printername = :printername  ' +&#13;&#10;    '  and ol.usr$quantity + 0 &#62; 0  ' +&#13;&#10;    '  and ol.usr$causedeletekey + 0 is null  ' +&#13;&#10;    '  and setprn.usr$computername = :COMP  ' +&#13;&#10;    '  and setprn.usr$kassa + 0 = 0 ';&#13;&#10;  if PrnGrID &#60;&#62; 0 then&#13;&#10;    S := S + '  and prngr.id = :prngrid ';&#13;&#10;  S := S +&#13;&#10;    'ORDER BY ' +&#13;&#10;    '  prngr.usr$name, ol.documentkey ';      &#13;&#10;&#13;&#10;  Query := BaseQuery.Query[BaseQuery.Add('Query', False)];&#13;&#10;  Query.SQL := S;&#13;&#10;  Query.ParamByName('docid').AsInteger := DocID;&#13;&#10;  Query.ParambyName('printername').AsString := &#60;PrinterName&#62;;     &#13;&#10;  Query.ParambyName('comp').AsString := &#60;ComputerName&#62;;     &#13;&#10;  if PrnGrID &#60;&#62; 0 then&#13;&#10;    Query.ParambyName('prngrid').Value := PrnGrID;&#13;&#10;  Query.Open;      &#13;&#10;&#13;&#10;  MemTable := BaseQuery.Query[BaseQuery.Add('HEADER', True)];&#13;&#10;  MemTable.CreateDataSetAs(Query);&#13;&#10;  MemTable.AddField('TIME', 'ftTime', 0, False);                                                                               &#13;&#10;  MemTable.AddField('COMPRESSEDON', 'ftString', 10, False);&#13;&#10;  MemTable.AddField('BELL', 'ftString', 10, False);  &#13;&#10;  MemTable.AddField('BOLD', 'ftString', 10, False);&#13;&#10;  MemTable.AddField('ENDBOLD', 'ftString', 10, False);&#13;&#10;  MemTable.AddField('RESET', 'ftString', 10, False);    &#13;&#10;  MemTable.AddField('DOUBLESIZE', 'ftString', 10, False);&#13;&#10;  MemTable.AddField('ENDDOUBLESIZE', 'ftString', 10, False);  &#13;&#10;  MemTable.AddField('MODNAME', 'ftString', 60, False);&#13;&#10;  MemTable.Open;&#13;&#10;&#13;&#10;    &#13;&#10;  Bold := ''; //chr(&#38;H1B) + CHR(&#38;H21) + CHR(&#38;H08)&#13;&#10;  EndBold := ''; //chr(&#38;H1B) + CHR(&#38;H21) + CHR(&#38;H80)&#13;&#10;&#13;&#10;  DOUBLESIZE := '';  //chr(&#38;H1B) + CHR(&#38;H21) + CHR(&#38;H30)&#13;&#10;  ENDDOUBLESIZE := ''; //chr(&#38;H1B) + CHR(&#38;H21) + CHR(&#38;H08)&#13;&#10;  LineKey := 0;&#13;&#10;&#13;&#10;  Query.First;&#13;&#10;  while not Query.Eof do&#13;&#10;  begin&#13;&#10;    MemTable.Append;&#13;&#10;    I := 0;&#13;&#10;    while i &#60;= Query.FieldCount - 1 do&#13;&#10;    begin&#13;&#10;      MemTable.Fields(i).AsString := Query.Fields(I).AsString;&#13;&#10;      I := I + 1;                                      &#13;&#10;    end;&#13;&#10;&#13;&#10;    if Query.FieldByName('documentkey').AsInteger = Linekey then&#13;&#10;    begin&#13;&#10;      MemTable.FieldbyName('goodname').AsString := Query.FieldByName('modifyname').AsString;&#13;&#10;      MemTable.FieldbyName('Q').AsString := '';&#13;&#10;    end;&#13;&#10;    if (Query.FieldByName('documentkey').AsInteger &#60;&#62; Linekey) and&#13;&#10;      (Query.FieldByName('modifyname').AsString &#60;&#62; '')&#13;&#10;    then&#13;&#10;      begin&#13;&#10;        MemTable.FieldByName('modifyname').AsString := '';&#13;&#10;        MemTable.FieldbyName('TIME').AsdateTime := Query.FieldByName('time1').AsDateTime;&#13;&#10;        MemTable.FieldByNAme('COMPRESSEDON').AsVariant := ''; // 'chr(&#38;H1D) + CHR(&#38;H56) + CHR(&#38;H01)&#13;&#10;        MemTable.FieldByNAme('RESET').AsVariant := ''; //'chr(&#38;H1B) + CHR(&#38;H40)&#13;&#10;        MemTable.FieldByNAme('BELL').AsVariant := ''; //'chr(&#38;H1B) + CHR(&#38;H70) + &#34;0&#34; + CHR(0) + chr(0)&#13;&#10;        MemTable.Post;&#13;&#10;        MemTable.Append;&#13;&#10;        I := 0;&#13;&#10;        while I &#60;= Query.FieldCount - 1 do&#13;&#10;        begin&#13;&#10;          MemTable.Fields(I).AsString := Query.Fields(I).AsString;&#13;&#10;          I := I + 1;&#13;&#10;        end;&#13;&#10;        MemTable.FieldbyName('GOODNAME').AsString := Query.FieldByName('modifyname').AsString;&#13;&#10;        MemTable.FieldbyName('Q').AsString := '';&#13;&#10;      end;&#13;&#10;&#13;&#10;    if (Query.FieldByName('documentkey').AsInteger &#60;&#62; Linekey) and&#13;&#10;      (Query.FieldByName('extramodify').AsString &#60;&#62; '')&#13;&#10;    then&#13;&#10;      begin&#13;&#10;        MemTable.FieldByName('modifyname').AsString := '';&#13;&#10;        MemTable.FieldbyName('TIME').AsdateTime := Query.FieldByName('time1').AsDateTime;&#13;&#10;        MemTable.FieldByNAme('COMPRESSEDON').AsVariant := ''; // 'chr(&#38;H1D) + CHR(&#38;H56) + CHR(&#38;H01)&#13;&#10;        MemTable.FieldByNAme('RESET').AsVariant := ''; //'chr(&#38;H1B) + CHR(&#38;H40)&#13;&#10;        MemTable.FieldByNAme('BELL').AsVariant := ''; //'chr(&#38;H1B) + CHR(&#38;H70) + &#34;0&#34; + CHR(0) + chr(0)&#13;&#10;        MemTable.Post;&#13;&#10;        MemTable.Append;&#13;&#10;        I := 0;&#13;&#10;        while I &#60;= Query.FieldCount - 1 do&#13;&#10;        begin&#13;&#10;          MemTable.Fields(I).AsString := Query.Fields(I).AsString;&#13;&#10;          I := I + 1;&#13;&#10;        end;&#13;&#10;        MemTable.FieldbyName('GOODNAME').AsString := ' *** ' + Query.FieldByName('extramodify').AsString + ' *** ';&#13;&#10;        MemTable.FieldbyName('Q').AsString := '';&#13;&#10;      end;&#13;&#10;&#13;&#10;    Linekey := Query.FieldByName('documentkey').AsInteger;&#13;&#10;    MemTable.FieldbyName('TIME').AsdateTime := Query.FieldByName('time1').AsDateTime;&#13;&#10;    MemTable.FieldByNAme('COMPRESSEDON').AsVariant := ''; // 'chr(&#38;H1D) + CHR(&#38;H56) + CHR(&#38;H01)&#13;&#10;    MemTable.FieldByNAme('RESET').AsVariant := ''; //'chr(&#38;H1B) + CHR(&#38;H40)&#13;&#10;    MemTable.FieldByNAme('BELL').AsVariant := ''; //'chr(&#38;H1B) + CHR(&#38;H70) + &#34;0&#34; + CHR(0) + chr(0)&#13;&#10;    MemTable.Post;&#13;&#10;&#13;&#10;    Query.Next;&#13;&#10;  end;&#13;&#10;      &#13;&#10;    &#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." ShowProgress="False" OnBeforeReportPrint="OnBeforeReportPrint" PropData="0844617461736574730100095661726961626C657301010612204E616D653D222052657374506172616D220001061B204E616D653D2250726E47724944222056616C75653D222730272200010619204E616D653D22446F634944222056616C75653D22273027220001061E204E616D653D225072696E7465724E616D65222056616C75653D2227272200010626204E616D653D22436F6D70757465724E616D65222056616C75653D2227415355532D504327220000055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000"/>
  <TfrxDMPPage Name="Page1" PaperWidth="99.0599360237913" PaperHeight="296.862308276426" PaperSize="256" LeftMargin="2.53999835958439" RightMargin="2.53999835958439" TopMargin="4.49791376176403" BottomMargin="4.49791376176403" ColumnWidth="0" ColumnPositions.Text="" EndlessHeight="True" HGuides.Text="" VGuides.Text="" FontStyle="0">
    <TfrxReportTitle Name="ReportTitle1" Height="136" Left="0" Top="17" Width="355.2">
      <TfrxDMPCommand Name="DMPCommand1" Description="Reset Printer" Left="0" Top="0" Width="355.2" Height="17" Hint="Reset Printer" ShowHint="False" Command="1B401B703020201D2101"/>
      <TfrxDMPMemoView Name="DMPMemo3" Left="0" Top="17" Width="67.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="Номер:"/>
      <TfrxDMPMemoView Name="DMPMemo4" Left="0" Top="34" Width="96" Height="17" ShowHint="False" FontStyle="256" ParentFont="False" TruncOutboundText="False" Text="Официант:"/>
      <TfrxDMPMemoView Name="DMPMemo5" Left="0" Top="51" Width="57.6" Height="17" ShowHint="False" TruncOutboundText="False" Text="Дата:"/>
      <TfrxDMPMemoView Name="DMPMemo6" Left="0" Top="68" Width="76.8" Height="17" ShowHint="False" TruncOutboundText="False" Text="Гостей:"/>
      <TfrxDMPMemoView Name="DMPMemo7" Left="172.8" Top="51" Width="67.2" Height="17" ShowHint="False" HAlign="haRight" TruncOutboundText="False" Text="Время:"/>
      <TfrxDMPMemoView Name="DMPMemo8" Left="124.8" Top="68" Width="115.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="Стол открыт:"/>
      <TfrxDMPMemoView Name="DMPMemo9" Left="67.2" Top="17" Width="288" Height="17" ShowHint="False" TruncOutboundText="False" Text="[HEADER.&#34;NUM&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo10" Left="96" Top="34" Width="259.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="[HEADER.&#34;CONNAME&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo11" Left="57.6" Top="51" Width="105.6" Height="17" ShowHint="False" DisplayFormat.FormatStr="dd.mm.yyyy" DisplayFormat.Kind="fkDateTime" TruncOutboundText="False" Text="[HEADER.&#34;DOCUMENTDATE&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo12" Left="240" Top="51" Width="115.2" Height="17" ShowHint="False" DisplayFormat.FormatStr="hh:mm:ss" DisplayFormat.Kind="fkDateTime" TruncOutboundText="False" Text="[HEADER.&#34;TIME&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo13" Left="76.8" Top="68" Width="38.4" Height="17" ShowHint="False" TruncOutboundText="False" Text="[HEADER.&#34;GUEST&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo14" Left="240" Top="68" Width="115.2" Height="17" ShowHint="False" DisplayFormat.FormatStr="hh:mm:ss" DisplayFormat.Kind="fkDateTime" TruncOutboundText="False" Text="[HEADER.&#34;OPEN1&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo15" Left="0" Top="85" Width="355.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="-------------------------------------"/>
      <TfrxDMPMemoView Name="DMPMemo16" Left="0" Top="119" Width="355.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="-------------------------------------"/>
      <TfrxDMPMemoView Name="DMPMemo17" Left="67.2" Top="102" Width="288" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="Название блюда"/>
      <TfrxDMPMemoView Name="DMPMemo18" Left="0" Top="102" Width="67.2" Height="17" ShowHint="False" HAlign="haCenter" TruncOutboundText="False" Text="Кол-во"/>
    </TfrxReportTitle>
    <TfrxMasterData Name="MasterData1" Height="17" Left="0" Top="204" Width="355.2" ColumnWidth="0" ColumnGap="0" DataSetName="HEADER" RowCount="0" Stretched="True">
      <TfrxDMPMemoView Name="DMPMemo19" Left="67.2" Top="0" Width="288" Height="17" ShowHint="False" StretchMode="smMaxHeight" DataSetName="HEADER" FontStyle="64" ParentFont="False" TruncOutboundText="False" Text="[HEADER.&#34;GOODNAME&#34;]"/>
      <TfrxDMPMemoView Name="DMPMemo20" Left="0" Top="0" Width="67.2" Height="17" ShowHint="False" StretchMode="smMaxHeight" HideZeros="True" TruncOutboundText="False" Text="[HEADER.&#34;Q&#34;]"/>
    </TfrxMasterData>
    <TfrxGroupHeader Name="GroupHeader1" Height="0" Left="0" Top="187" Width="355.2" Condition="HEADER.&#34;PRNGROUPNAME&#34;">
      <TfrxDMPMemoView Name="DMPMemo21" Left="0" Top="0" Width="364.8" Height="0" ShowHint="False" FontStyle="64" ParentFont="False" TruncOutboundText="False" Text="[HEADER.&#34;PRNGROUPNAME&#34;]"/>
    </TfrxGroupHeader>
    <TfrxGroupFooter Name="GroupFooter1" Height="17" Left="0" Top="238" Width="355.2">
      <TfrxDMPMemoView Name="DMPMemo1" Left="0" Top="0" Width="355.2" Height="17" ShowHint="False" TruncOutboundText="False" Text="-------------------------------------"/>
    </TfrxGroupFooter>
    <TfrxReportSummary Name="ReportSummary1" Height="34" Left="0" Top="289" Width="355.2">
      <TfrxDMPCommand Name="DMPCommand3" Description="Page Break" Left="0" Top="0" Width="355.2" Height="17" Hint="Page Break" ShowHint="False" Command="1D5601"/>
      <TfrxDMPMemoView Name="DMPMemo23" Left="0" Top="17" Width="355.2" Height="17" ShowHint="False" TruncOutboundText="False" Text=""/>
    </TfrxReportSummary>
  </TfrxDMPPage>
</Tgs_fr4SingleReport>
