<?xml version="1.0" encoding="utf-8" standalone="no"?>
<Tgs_fr4SingleReport Version="4.8.2" DotMatrixReport="False" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="Default" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="40488.7675301157" ReportOptions.Description.Text="" ReportOptions.LastChange="40708.7299109259" ScriptLanguage="PascalScript" ScriptText.Text="procedure OnBeforeReportPrint(Sender: TfrxComponent);&#13;&#10;var&#13;&#10;  MemTable, Header: TgsDataSet;&#13;&#10;  BaseQuery: QueryList;&#13;&#10;  I: Integer;                           &#13;&#10;begin&#13;&#10;  &#13;&#10;  BaseQuery := GetQueryList;&#13;&#10;  BaseQuery.Clear;&#13;&#10;    &#13;&#10;  Header := BaseQuery.Query[BaseQuery.Add('Header1', False)];&#13;&#10;  Header.SQL :=&#13;&#10;    '  SELECT comp.name compname, comp.address compadr, comp.city compcity,  ' +&#13;&#10;    '  g.alias a, g.name goodname, ol.usr$costncu C, ' +&#13;&#10;    '  con.name conname, doc.documentdate as docdate, doc.number docnum, ' +&#13;&#10;    '  o.usr$guestcount guest, o.usr$timeorder as open1, current_time as close1, current_timestamp as date1, ' +&#13;&#10;    '  o.usr$cash cash, d.usr$surname as surname, d.usr$middlename midle, d.usr$firstname firstn, d.USR$cardnum cardnum, ' +&#13;&#10;    '  SUM(ol.usr$sumncu) S, ' +&#13;&#10;    '  SUM(ol.usr$sumncuwithdiscount) SWD, ' +&#13;&#10;    '  SUM(ol.usr$sumdiscount) SD, ' +&#13;&#10;    '  Sum(ol.usr$quantity) q  ' +&#13;&#10;    '  FROM gd_document doc  ' +&#13;&#10;    '  JOIN usr$mn_order o ON o.documentkey = doc.id ' +&#13;&#10;    '    AND doc.id = :dockey ' +&#13;&#10;    '  JOIN usr$mn_orderline ol on ol.masterkey = o.documentkey  ' +&#13;&#10;    '  JOIN gd_good g ON g.id = ol.usr$goodkey  ' +&#13;&#10;    '  LEFT JOIN gd_contact comp ON comp.id = doc.companykey  ' +&#13;&#10;    '  LEFT JOIN usr$mn_p_getcontact_department(usr$respkey) cd ON 0 = 0  ' +&#13;&#10;    '  LEFT JOIN gd_contact con ON con.id = cd.peoplekey ' +&#13;&#10;    '  LEFT JOIN gd_contact dept ON dept.id = cd.departmentkey  ' +&#13;&#10;    '  left join usr$mn_discountcard d on d.id = o.usr$disccardkey ' +&#13;&#10;    '  where ol.usr$causedeletekey + 0 is null ' +&#13;&#10;    '  GROUP BY ' +&#13;&#10;    '  comp.name, comp.address, comp.city, ' +&#13;&#10;    '  g.name, g.alias, ol.usr$costncu, ' +&#13;&#10;    '  con.name, doc.documentdate, doc.number,  ' +&#13;&#10;    '  o.usr$guestcount, o.usr$timeorder, o.usr$timecloseorder, 13, ' +&#13;&#10;    '  o.usr$cash, d.usr$surname, d.usr$middlename, d.usr$firstname, d.USR$cardnum  ' +&#13;&#10;    '  having Sum(ol.usr$quantity) &#62; 0 ';            &#13;&#10;  Header.ParamByName('dockey').AsInteger := StrToInt(&#60;DocID&#62;);                                &#13;&#10;  Header.Open;&#13;&#10;&#13;&#10;  MemTable :=  BaseQuery.Query[BaseQuery.Add('HEADER', True)];&#13;&#10;  MemTable.CreateDataSetAs(Header);&#13;&#10;  MemTable.AddField('NOW', 'ftDate', 0, False);&#13;&#10;  MemTable.AddField('NOWTIME', 'ftTime', 0, False);&#13;&#10;  MemTable.AddField('COMPRESSEDON', 'ftString', 5, False);  &#13;&#10;  MemTable.AddField('RUSPAGE', 'ftString', 5, False);      &#13;&#10;  MemTable.AddField('CUTPAGE', 'ftString', 15, False);  &#13;&#10;  MemTable.AddField('DISKN', 'ftString', 60, False);&#13;&#10;  MemTable.Open;&#13;&#10;    &#13;&#10;  Header.First;&#13;&#10;  while not Header.Eof do&#13;&#10;  begin&#13;&#10;    MemTable.Append;&#13;&#10;    I := 0;&#13;&#10;    while I &#60;= Header.FieldCount - 1 do&#13;&#10;    begin&#13;&#10;      MemTable.Fields(I).AsString := Header.Fields(I).AsString;&#13;&#10;      I := I + 1;                                &#13;&#10;    end;&#13;&#10;&#13;&#10;    MemTable.FieldbyName('NOW').AsDateTime := Header.FieldByName('date1').AsDateTime;;&#13;&#10;    MemTable.FieldbyName('NOWTIME').AsDateTime := Header.FieldByName('close1').AsDateTime;&#13;&#10;    MemTable.FieldByName('COMPRESSEDON').AsVariant := ''; // 'chr(&#38;H1D) + CHR(&#38;H56) + CHR(&#38;H01)&#13;&#10;    MemTable.FieldByName('RUSPAGE').AsVariant := '';&#13;&#10;    if Header.FieldByName('surname').AsString &#60;&#62; '' then&#13;&#10;      MemTable.FieldByNAme('DISKN').AsString := 'Карточка:' + Header.FieldByName('cardnum').AsString +&#13;&#10;        #13#10 + Header.FieldByName('surname').AsString + ' ' +&#13;&#10;        Header.FieldByName('firstn').AsString + ' ' + Header.FieldByName('midle').AsString;                    &#13;&#10;    MemTable.Post;&#13;&#10;&#13;&#10;    Header.Next;&#13;&#10;  end;      &#13;&#10;  &#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." ShowProgress="False" OnBeforeReportPrint="OnBeforeReportPrint" PropData="0844617461736574730100095661726961626C657301010612204E616D653D222052657374506172616D2200010619204E616D653D22446F634944222056616C75653D22273027220000055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000"/>
  <TfrxReportPage Name="Page1" PaperWidth="72" PaperHeight="1000" PaperSize="256" LeftMargin="2" RightMargin="0" TopMargin="1" BottomMargin="1" ColumnWidth="0" ColumnPositions.Text="" HGuides.Text="" VGuides.Text="">
    <TfrxReportTitle Name="ReportTitle1" Height="105.82684" Left="0" Top="18.89765" Width="264.5671">
      <TfrxMemoView Name="Memo1" Left="7.55906" Top="0" Width="257.00804" Height="26.45671" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-8" Font.Name="Arial" Font.Style="0" HAlign="haCenter" ParentFont="False" Text="[HEADER.&#34;COMPNAME&#34;]&#13;&#10;[HEADER.&#34;COMPADR&#34;]"/>
      <TfrxMemoView Name="Memo2" Left="7.55906" Top="26.45671" Width="257.00804" Height="30.23624" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-24" Font.Name="Arial" Font.Style="1" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="С Ч Ё Т"/>
      <TfrxMemoView Name="Memo4" Left="7.55906" Top="75.5906" Width="75.5906" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="Дата: [HEADER.&#34;DOCDATE&#34;]"/>
      <TfrxMemoView Name="Memo5" Left="7.55906" Top="56.69295" Width="68.03154" Height="18.89765" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="Стол №:"/>
      <TfrxMemoView Name="Memo6" Left="83.14966" Top="75.5906" Width="86.92919" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="Открыт : [HEADER.&#34;OPEN1&#34;]"/>
      <TfrxMemoView Name="Memo7" Left="75.5906" Top="56.69295" Width="188.9765" Height="18.89765" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-19" Font.Name="Arial" Font.Style="1" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[HEADER.&#34;DOCNUM&#34;]"/>
      <TfrxMemoView Name="Memo3" Left="7.55906" Top="90.70872" Width="196.53556" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="Официант:[HEADER.&#34;CONNAME&#34;]"/>
      <TfrxMemoView Name="Memo8" Left="204.09462" Top="90.70872" Width="60.47248" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" HAlign="haRight" ParentFont="False" Text="Гостей: [HEADER.&#34;GUEST&#34;]"/>
      <TfrxMemoView Name="Memo14" Left="170.07885" Top="75.5906" Width="94.48825" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" HAlign="haRight" ParentFont="False" Text="Закрыт : [HEADER.&#34;CLOSE1&#34;]"/>
    </TfrxReportTitle>
    <TfrxHeader Name="Header1" Height="15.11812" Left="0" Top="185.19697" Width="264.5671">
      <TfrxMemoView Name="Memo10" Left="7.55906" Top="0" Width="136.06308" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" Frame.Typ="12" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Наименование блюда"/>
      <TfrxMemoView Name="Memo11" Left="185.19697" Top="0" Width="34.01577" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" Frame.Typ="12" GapX="0" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Кол-во"/>
      <TfrxMemoView Name="Memo12" Left="143.62214" Top="0" Width="41.57483" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" Frame.Typ="12" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Цена"/>
      <TfrxMemoView Name="Memo16" Left="219.21274" Top="0" Width="45.35436" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" Frame.Typ="12" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Сумма"/>
    </TfrxHeader>
    <TfrxMasterData Name="MasterData1" Height="18.89765" Left="0" Top="222.99227" Width="264.5671" ColumnWidth="0" ColumnGap="0" DataSetName="HEADER" RowCount="0" Stretched="True">
      <TfrxMemoView Name="Memo13" Left="185.19697" Top="0" Width="34.01577" Height="18.89765" ShowHint="False" StretchMode="smMaxHeight" DataField="Q" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[HEADER.&#34;Q&#34;]"/>
      <TfrxMemoView Name="Memo9" Left="7.55906" Top="0" Width="136.06308" Height="18.89765" ShowHint="False" StretchMode="smMaxHeight" DataField="GOODNAME" DataSetName="HEADER" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" ParentFont="False" VAlign="vaCenter" Text="[HEADER.&#34;GOODNAME&#34;]"/>
      <TfrxMemoView Name="Memo15" Left="143.62214" Top="0" Width="41.57483" Height="18.89765" ShowHint="False" StretchMode="smMaxHeight" DataField="C" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[HEADER.&#34;C&#34;]"/>
      <TfrxMemoView Name="Memo17" Left="219.21274" Top="0" Width="45.35436" Height="18.89765" ShowHint="False" StretchMode="smMaxHeight" DataField="S" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[HEADER.&#34;S&#34;]"/>
    </TfrxMasterData>
    <TfrxFooter Name="Footer1" Height="109.60637" Left="0" Top="264.5671" Width="264.5671">
      <TfrxMemoView Name="Memo18" Left="7.55906" Top="0" Width="68.03154" Height="18.89765" ShowHint="False" DataSetName="HEADER" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="12" Frame.TopLine.Width="2" Frame.BottomLine.Width="0.5" ParentFont="False" VAlign="vaCenter" Text=" Сумма :"/>
      <TfrxMemoView Name="Memo19" Left="75.5906" Top="0" Width="188.9765" Height="18.89765" ShowHint="False" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="12" Frame.TopLine.Width="2" Frame.BottomLine.Width="0.5" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[SUM(&#60;HEADER.&#34;S&#34;&#62;)]"/>
      <TfrxMemoView Name="Memo20" Left="7.55906" Top="18.89765" Width="68.03154" Height="18.89765" ShowHint="False" DataSetName="HEADER" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" ParentFont="False" VAlign="vaCenter" Text=" Скидка :"/>
      <TfrxMemoView Name="Memo21" Left="75.5906" Top="18.89765" Width="188.9765" Height="18.89765" ShowHint="False" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="8" Frame.BottomLine.Width="0.5" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[SUM(&#60;HEADER.&#34;SD&#34;&#62;)]"/>
      <TfrxMemoView Name="Memo22" Left="7.55906" Top="37.7953" Width="105.82684" Height="37.7953" ShowHint="False" DataSetName="HEADER" Font.Charset="1" Font.Color="0" Font.Height="-16" Font.Name="Arial" Font.Style="1" Frame.Typ="12" Frame.Width="2" ParentFont="False" VAlign="vaCenter" Text=" В С Е Г О :"/>
      <TfrxMemoView Name="Memo23" Left="113.3859" Top="37.7953" Width="151.1812" Height="37.7953" ShowHint="False" DataSetName="HEADER" DisplayFormat.ThousandSeparator=" " DisplayFormat.FormatStr="%2.0n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-16" Font.Name="Arial" Font.Style="1" Frame.Typ="12" Frame.Width="2" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[SUM(&#60;HEADER.&#34;SWD&#34;&#62;)]"/>
      <TfrxMemoView Name="Memo25" Left="7.55906" Top="94.48825" Width="124.72449" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="Дата: [HEADER.&#34;NOW&#34;]"/>
      <TfrxMemoView Name="Memo26" Left="132.28355" Top="94.48825" Width="132.28355" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" HAlign="haRight" ParentFont="False" Text="Время: [HEADER.&#34;NOWTIME&#34;]"/>
      <TfrxMemoView Name="Memo27" Left="7.55906" Top="79.37013" Width="257.00804" Height="15.11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Arial" Font.Style="0" ParentFont="False" Text="[HEADER.&#34;DISKN&#34;]"/>
    </TfrxFooter>
  </TfrxReportPage>
</Tgs_fr4SingleReport>
